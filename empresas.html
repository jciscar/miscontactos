<?php
session_start();
?>
<!DOCTYPE html>
<html lang="es">
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Empresas</title>

    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css">
    <script src="lib/jquery/jquery.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <link rel="stylesheet" href="lib/icons/font/bootstrap-icons.css">
    
    <link rel="stylesheet" href="lib/bootstrap-table/dist/bootstrap-table.min.css">
    <script src="lib/bootstrap-table/dist/bootstrap-table.min.js"></script>

    <script src="lib/bootstrap-table/dist/locale/bootstrap-table-es-ES.min.js"></script>
    
    <script src="lib/bootstrap-table/dist/tableExport.min.js"></script>
    <script src="lib/bootstrap-table/dist/extensions/auto-refresh/bootstrap-table-auto-refresh.min.js"></script>

  	<script src="lib/gp/libgp01.js"></script>

  	<link rel="shortcut icon" href="lib/ico/logo.ico">

<script>

function abrirEmpresaSeleccionada() {

	if (window.idTabEmpresas == localStorage.getItem('empActiva')) {
		document.getElementById('msjEmpresa').innerText = 'Esta empresa ya estaba abierta';
		let myModal = new bootstrap.Modal(document.getElementById('dialogoEmpresa'));
		myModal.show();		
		return false;
	}
	var finalizadoAbrirEmp = false;
	var paso = 0;
	var formData5 = new FormData();
	formData5.append('emp', window.idTabEmpresas);
	async function datosDevueltos5() {
	    const response5 = await fetch('php/cambiarEmpresaActiva.php', {
	        method: 'POST',
	        body: formData5
	    });
	    const data5 = await response5.json();
	    return data5;
  	}
  	datosDevueltos5().then((data5) => {
		if (data5 == 'OK') { 
			finalizadoAbrirEmp = true;
		}
	}).catch(
		error => { alert(error.message);
	}).finally( ()  => {
		if (finalizadoAbrirEmp) {
			let correo 		= localStorage.getItem('eMail');
			let usuario 	= localStorage.getItem('nomUs');
			let contrasena 	= localStorage.getItem('contrasena');
			let bEntrada 	= entrada(correo, usuario, contrasena, window.idTabEmpresas, false);
			if (bEntrada) {
				document.getElementById('msjEmpresa').innerText = 'Empresa abierta con éxito';
				let myModal = new bootstrap.Modal(document.getElementById('dialogoEmpresa'));
				myModal.show();				
			}
		}
	});

}


</script>


<style>

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    /* Firefox */
    input[type=number] {
      -moz-appearance: textfield;
    }

    @media (max-width: 992px) {
        #titulo { font-size: 18px };
    }  

    @media (min-width: 993px) {
        #aceptar:after  { content: '  Guardar';}
        #cancelar:after { content: '  Cancelar';}
    }

    @media (min-width: 993px) {
        #aceptar1:after     { content: '  Guardar';}
        #cancelar1:after { content: '  Cancelar';}
    }   

    .success {
            background: #92c5fc;
            font-weight: bold;
    }   

    .success1 {
            background: #92c5fc;
            font-weight: bold;
    }       

    .closed { display: none; }
    .opened { display: block; }

    .wrapper {
        overflow-y: hidden;
        overflow-x: hidden;
    }

    .dropdown-menu > li:hover > .submenu{ display: block; margin-left:2rem; }


	/* The snackbar - position it at the bottom and in the middle of the screen */
	#snackbar {
	  visibility: hidden; /* Hidden by default. Visible on click */
	  min-width: 250px; /* Set a default minimum width */
	  margin-left: -125px; /* Divide value of min-width by 2 */
	  background-color: #333; /* Black background color */
	  color: #fff; /* White text color */
	  text-align: center; /* Centered text */
	  border-radius: 2px; /* Rounded borders */
	  padding: 16px; /* Padding */
	  position: fixed; /* Sit on top of the screen */
	  z-index: 1; /* Add a z-index if needed */
	  left: 50%; /* Center the snackbar */
	  bottom: 30px; /* 30px from the bottom */
	}

	/* Show the snackbar when clicking on a button (class added with JavaScript) */
	#snackbar.show {
	  visibility: visible; /* Show the snackbar */
	  /* Add animation: Take 0.5 seconds to fade in and out the snackbar.
	  However, delay the fade out process for 2.5 seconds */
	  -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
	  animation: fadein 0.5s, fadeout 0.5s 2.5s;
	}

	/* Animations to fade the snackbar in and out */
	@-webkit-keyframes fadein {
	  from {bottom: 0; opacity: 0;}
	  to {bottom: 30px; opacity: 1;}
	}

	@keyframes fadein {
	  from {bottom: 0; opacity: 0;}
	  to {bottom: 30px; opacity: 1;}
	}

	@-webkit-keyframes fadeout {
	  from {bottom: 30px; opacity: 1;}
	  to {bottom: 0; opacity: 0;}
	}

	@keyframes fadeout {
	  from {bottom: 30px; opacity: 1;}
	  to {bottom: 0; opacity: 0;}
	}    

</style>

  </head>
  <body class="bg-light" onunload="descargar()">

  <script>

  	// gestión ventanas. Es la función que se ejecutar en onunload de body
  	function descargar() { despuesDeCerrarVentana('nExtEmpresas', 'empresas'); }

  	var $table = document.getElementById('tabEmpresas');

    document.addEventListener("DOMContentLoaded", function(event) {
    	compProcedencia();
    	primeraEntrada = true;

    	// gestión ventanas
    	despuesDeAbrirVentana('nExtEmpresas', 'empresas');

			$('[data-toggle="tooltip"]').tooltip({ trigger: "hover" });
			permisosVentana('empresas');
			cambiarAltoTabla();
			return false;

    });

	$(document).ready(function(e) {
		barraPaginacion('#tabEmpresas');
		if (window.nExtEmpresas != 0) { msjDblClic(); }
		return false;
	});	

	window.addEventListener("resize", function(event) {
		cambiarAltoTabla();
		return false;
	});

	//funciona en chrome pero no en firefox
	window.addEventListener("load", function(event) {
		//cambiarAltoTabla();
		return false;
	});	



	function eliminarEmpresa(){			
		let formDataE = new FormData();
		formDataE.append("nform", 'empresas');
		formDataE.append("codnum", window.idTabEmpresas);
		formDataE.append("opcionlistado", 3);
		async function comprobarAntesDeEliminar() {
			const comprobarResponse = await fetch('php/comprobar_antes_de_editar_o_eliminar.php', {
	      		method: 'POST',
	      		body: 	formDataE
	    	});
			const dataE = await comprobarResponse.json();
			return dataE;
		}
		comprobarAntesDeEliminar().then((dataE) => {
			if (dataE == '[object Object]') {
				let myModal = new bootstrap.Modal(document.getElementById('formEliminarEmpresa'));
				myModal.show();
				empE.defaultValue = dataE.emp;
				nomE.defaultValue = dataE.nom;
			} else {
				document.getElementById('msjEmpresa').innerText = dataE;
				let myModal = new bootstrap.Modal(document.getElementById('dialogoEmpresa'));
				myModal.show();
			};				
		}).catch(error => {
			alert(error.message);
		});
    return false;
	}


</script>




<div class="wrapper">


	<div class="container-fluid sticky-top bg-light" id="contenedor">
	  	<div class="row justify-content-between align-content-center gx-0 gy-2" id="fila">

		  	<div class="col-auto d-none d-md-block mt-2 mb-2">
				 <div class="btn-group" role="group">
					<button class="btn btn-success btn-sm" id="NuevaEmpresa" title="Nueva empresa" data-toggle="tooltip" onClick="regTabla('modalEmpresa', 'opcionEmpresa', 1)" style="display: none;"><i class="bi bi-person-plus-fill" style="font-size: 1.4rem; color: currentColor;"></i></button>
					<button class="btn btn-success btn-sm" id="EditarEmpresa" title="Editar empresa" data-toggle="tooltip" onClick="regTabla('modalEmpresa', 'opcionEmpresa', 2)"><i class="bi bi-person-lines-fill" style="font-size: 1.4rem; color: currentColor;"></i></button>
					<button class="btn btn-success btn-sm" id="EliminarEmpresa" title="Eliminar empresa" data-toggle="tooltip" onClick="eliminarEmpresa()" style="display: none;"><i class="bi bi-person-dash-fill" style="font-size: 1.4rem; color: currentColor;"></i></button>
					<button class="btn btn-success btn-sm" id="VerEmpresa" title="Ver empresa" data-toggle="tooltip" onClick="regTabla('modalEmpresa', 'opcionEmpresa', 4)"><i class="bi bi-person-fill" style="font-size: 1.4rem; color: currentColor;"></i></button>
					<button class="btn btn-success btn-sm" id="AbrirEmpresa" title="Abrir la empresa seleccionada" data-toggle="tooltip" onClick="abrirEmpresaSeleccionada()" style="display: none;"><i class="bi bi-folder2-open" style="font-size: 1.4rem; color: currentColor;"></i></button>

				</div>
			</div>

			<div class="col-auto align-self-center d-none d-lg-block mt-2 mb-2">
				<a class="navbar-brand" style="font-weight:bold;" id="titulo">Empresas</a>
			</div>

			<div class="col-auto d-sm-block d-md-none mt-2 mb-2">
				<button class="btn btn-success dropdown-toggle" type="button" id="MenuMovil" data-bs-toggle="dropdown" aria-expanded="false">
				<i class="bi bi-list" style="font-size: 1rem; color: currentColor;"></i> </button>
			  	<ul class="dropdown-menu" aria-labelledby="MenuMovil">

					<li><a class="dropdown-item" onClick="regTabla('modalEmpresa', 'opcionEmpresa', 1)" href="#" style="display: none;"><i class="bi bi-person-plus-fill" style="font-size: 1rem; color: currentColor;"></i> Nueva empresa</a></li>
					<li><a class="dropdown-item" onClick="regTabla('modalEmpresa', 'opcionEmpresa', 2)" href="#"><i class="bi bi-person-lines-fill" style="font-size: 1rem; color: currentColor;"></i> Editar empresa</a></li>
					<li><a class=" dropdown-item" onClick="eliminarEmpresa()" href="#" style="display: none;"><i class="bi bi-person-dash-fill" style="font-size: 1rem; color: currentColor;"></i> Eliminar empresa</a></li>
					<li><a class="dropdown-item" onClick="regTabla('modalEmpresa', 'opcionEmpresa', 4)" href="#"><i class="bi bi-person-fill" style="font-size: 1rem; color: currentColor;"></i> Ver empresa</a></li>
					<li><a class="dropdown-item" onClick="abrirEmpresaSeleccionada()" href="#" style="display: none;"><i class="bi bi-folder2-open" style="font-size: 1rem; color: currentColor;"></i> Abrir empresa seleccionada</a></li>	

					<li><hr class="dropdown-divider"></li>

					<li class="dropend"><a class="dropdown-item dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" href="#" id="opcionesTablaSubmenu"><i class="bi bi-table" style="font-size: 1rem; color: currentColor;"></i> Tabla </a>
					  <ul class="submenu dropdown-menu" aria-labelledby="opcionesTablaSubmenu" id="opcion1">

			  			<li><a class="dropdown-item" onClick="valorTarjeta('tabEmpresas')" href="#"><i class="bi bi-card-list" style="font-size: 1rem; color: currentColor;"></i> Tarjeta/Tabla</a></li>

							<li><a class="dropdown-item" href="#" onClick="mostrarColumnas('modalColumnasTablasEmpresas', 0)"><i class="bi bi-layout-three-columns" style="font-size: 1rem; color: currentColor;"></i> Mostrar columnas</a></li>			  			

					  	<li><a class="dropdown-item" href="#" onClick="imprimirTabla('Empresas', tabEmpresas)"><i class="bi bi-printer" style="font-size: 1rem; color: currentColor;"></i> Imprimir</a></li>

					  	<li class="dropend"><a class="dropdown-item dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" href="#" id="opcionesExportarSubmenu"><i class="bi-file-earmark-arrow-down" style="font-size: 1rem; color: currentColor;"></i> Exportar a </a>
					  	 	<ul class="submenu submenu1 dropdown-menu" aria-labelledby="opcionesExportarSubmenu">
								<li><a class="dropdown-item" onClick="exportarTabla('excel','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">MS-Excel</a></li>
								<li><a class="dropdown-item" onClick="exportarTabla('csv','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">CSV</a></li>
								<li><a class="dropdown-item" onClick="exportarTabla('txt','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">TXT</a></li>
								<li><a class="dropdown-item" onClick="exportarTabla('json','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">JSON</a></li>
								<li><a class="dropdown-item" onClick="exportarTabla('sql','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">SQL</a></li>
					  	 	</ul>
					  	</li>
					 </ul>
				</li>
			</ul>
		</div>	


			<div class="col-auto mt-2 mb-2">

				<div class="btn-group" role="group">
					<div class="form-check form-switch btn-sm d-none d-md-block">
						<input class="form-check-input" type="checkbox" id="vistaTarjeta" title="Vista de tarjeta" data-toggle="tooltip" onchange="valorTarjeta('tabEmpresas')">
						<label class="form-check-label" for="vistaTarjeta"></label>
					</div>
				</div>

				<div class="btn-group" role="group">

					<button class="btn btn-success btn-sm d-none d-md-block" title="Mostrar columnas" data-toggle="tooltip" onClick="mostrarColumnas('modalColumnasTablasEmpresas', 0)"><i class="bi-layout-three-columns" style="font-size: 1.4rem; color: currentColor;"></i></button>

					<button class="btn btn-success btn-sm d-none d-md-block" id="imprimirEmpresas" title="Imprimir tabla" data-toggle="tooltip" onClick="imprimirTabla('Empresas', tabEmpresas)"><i class="bi bi-printer" style="font-size: 1.4rem; color: currentColor;"></i></button>
					<button class="btn btn-success btn-sm dropdown-toggle d-none d-md-block" type="button" id="exportarEmpresas" data-bs-toggle="dropdown" aria-expanded="false" title="Exportar tabla" data-toggle="tooltip">
					<i class="bi-file-earmark-arrow-down" style="font-size: 1.4rem; color: currentColor;"></i>
					</button>
				  	<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
				  		<li><h5 class="dropdown-header">Exportar a:</h5></li>
						<li><a class="dropdown-item" onClick="exportarTabla('excel','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">MS-Excel</a></li>
						<li><a class="dropdown-item" onClick="exportarTabla('csv','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">CSV</a></li>
						<li><a class="dropdown-item" onClick="exportarTabla('txt','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">TXT</a></li>
						<li><a class="dropdown-item" onClick="exportarTabla('json','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">JSON</a></li>
						<li><a class="dropdown-item" onClick="exportarTabla('sql','Empresas','Tabla de Empresas',100, 'tabEmpresas')" href="#">SQL</a></li>
				  	</ul>
				</div>
			</div>
			<div class="col-auto align-self-center mt-2 mb-2">
				<div class="btn-group" role="group">
			  		<input type="search" id="buscar" class="form-control" placeholder="Buscar" onchange="buscarAhora('tabEmpresas','buscar')" title="Buscar en la tabla" data-toggle="tooltip">
			  	</div>
			</div>
			<div class="col-auto mt-2 mb-2">
			  	<div class="btn-group" role="group">
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onClick="cerrarVentana('nExtEmpresas')" title="Cerrar" data-toggle="tooltip" style="text-align:right;"></button>
				</div>
			</div>
		</div>
	</div>

<script>

    opcionesTablaSubmenu.addEventListener('click',  (e) => { 
        e.stopPropagation();
    });

    opcionesExportarSubmenu.addEventListener('click',   (e) => { 
        e.stopPropagation();
    });

</script>

	<div id="snackbar">Doble clic para seleccionar la empresa</div>

	<!-- data-virtual-scroll siempre debe estar con el valor "false" para que funcione correctamente el scrolling vertical -->

	<div class="container-fluid" id="contenedor">
		<table class="table table-striped table-hover table-responsive" data-page-number="1" id="tabEmpresas" data-url="./php/datosTabla.php?vista=empresas" data-method="post" data-locale="es-sp" data-toggle="table" data-id-field="emp" data-undefined-text=""

	    data-unique-id="emp"

	    data-search="true"
	    data-show-search-button="false"
	    data-search-selector="#buscar"
	    data-search-highlight="true"
	    data-search-on-enter-key="false"

	    data-side-pagination="client"
	    data-pagination="false"
	    data-show-pagination-switch="false"

	    data-id-table="tabEmpresas"

	    data-click-to-select="true"
	    data-single-select="true"

	    data-sort-name="emp"
	    data-sort-order="asc"

	    data-virtual-scroll="false"

	  	data-icons-prefix="bi"
	  	data-icons="icons"

	    data-auto-refresh="true"
	    data-auto-refresh-interval="60"
		data-show-refresh="false"
	    data-show-auto-refresh="false"
	    data-auto-refresh-silent="true"

	    data-export-data-type="all"

	    data-detail-view="true"
	    
	    data-row-style="rowStyle"
	    data-detail-formatter="detailFormatter"

	    data-cache="false"
	   
	    >
	    
	    <thead class="bg-dark text-light">
		    <tr>
			    <th data-field="emp" data-sortable="true" data-click-to-select="true" data-switchable="false" data-align="right">Código</th>
			    <th data-field="nom" data-sortable="true" data-click-to-select="true" data-switchable="false">Empresa</th>
			    <th data-field="nif" data-sortable="true" data-click-to-select="true">NIF</th>
					<th data-field="noc" data-sortable="true" data-click-to-select="true">Nombre comercial</th>
				</tr>
	    </thead>
	    <tbody>
	    </tbody>

	  </table>
	</div>
</div>





<script>
	var $table 			=  $('#tabEmpresas');
	var numTab 			=  0;
	var indiceFila	= -1;
	var refresco 		= -1;
	var iPos 				=  0;

	$(function() {

    $table.on('click-row.bs.table', function (e, row, $element) {
    	window.idTabEmpresas			= row.emp;
    	indiceFila								= $element.index();
    	iPos											= $table.bootstrapTable('getScrollPosition');
			$('.success').removeClass('success');
    	$element.addClass('success');
    	return false;
    })

		$table.on('dbl-click-row.bs.table', function (e, row, $element) {	
			// gestión ventanas
			seleccionarRegistroYcerrar('nExtEmpresas', row.emp, row.nom);
		})

    $table.on('sort.bs.table', function (name, order) { 
    	refresco 	= -1;
    	return false;
    })

    $table.on('search.bs.table', function (text) {
    	refresco 	= -1;
    	return false;
    }) 

    $table.on('post-body.bs.table', function (data) {
				setTimeout(
			    function () {

			    	// refresco después de inicio, buscar u ordenar
			    	if (refresco == -1) {
							iPos 											= 0;
							if (primeraEntrada) {
								primeraEntrada = false;
								window.idTabEmpresas	 	= localStorage.getItem('empActiva');	
							} else {
								window.idTabEmpresas	 	= '';
							}
							indiceFila								= seleccionarFila('tabEmpresas', 'idTabEmpresas', 'emp', 'success');
		    			refresco 									= 0;
		    			return false;
			    	}

			    	// refresco después de añadir o eliminar
			    	if (refresco == 1) {
			    		indiceFila	= indice(window.idTabEmpresas, 'emp', 'tabEmpresas');
							iPos 				= Math.abs(tabEmpresas.getElementsByTagName('tr')[indiceFila].offsetTop) - 5;
			    	}

			    	// refresco regular
			    	$table.bootstrapTable('scrollTo', iPos);
			    	refresco = 0;
			    	return false;

				}, 500);
		})

	})

	window.icons = {
		detailOpen: 	'bi-caret-down-fill',
		detailClose: 	'bi-caret-up-fill'
	};

	function rowStyle(row, index) {
	  let customClass = "";
	  if (row.emp == window.idTabEmpresas) { customClass = 'success'; }
	  else {}
	  return { classes: customClass };
	}

	function detailFormatter(index, row) {
		let html = [];
		$.each(row, function (key, value) {
			if  (!(!value || value == '')) {
				let a = '';
				let b = '';
				if (key == 'emp') { a = 'Código'; b = value; }
				if (key == 'nom') { a = 'Nombre';	b = value; }
				if (key == 'nif') { a = 'NIF';	b = value; }
				if (key == 'noc') { a = 'Nombre comercial';	b = value; }
				if (!(!b || b == '')) {
					html.push('<div><b>' + a + ':</b> ' + b + '</div><p></p>');		
				}
			}
		})
		return html.join('');
	}

  function refrescar(n) {
    refresco = n;
    $table.bootstrapTable('refresh');
    return false;
  }

</script>





<!-- Comienzo modal columnas visibles -->
<div class="modal fade modal-dialog-scrollable" id="modalColumnasTablasEmpresas" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h6 class="modal-title">Columnas a mostrar</h6>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                </button>
            </div>
            <div class="modal-body">
            	<form>
            		<div class="form-group" id="listFields">
                	</div>
            	</form>
            </div>
        </div>
    </div>
</div>
<script>
		modalColumnasTablasEmpresas.addEventListener('show.bs.modal', function (e) {
				crearListadoNombresColumnas('modalColumnasTablasEmpresas');
		})
</script>


<!-- Comienzo modal eliminar -->
<div class="modal fade" id="formEliminarEmpresa" tabindex="-1">
  	<div class="modal-dialog">
      	<div class="modal-content">
      	  	
          	<!-- Modal Header -->
          	<div class="modal-header bg-light">
              	<h5 class="modal-title">Empresa</h5>
          		<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-toggle="tooltip" title="Cerrar ventana"></button>
          	</div>       
          	<!-- Modal body -->
          	<div class="modal-body">
		        	<div class="container-fluid">
		        		<form id="formDel">
									<div class="row align-items-end gx-3 gy-3 mb-3">
										<div class="col-auto">
											<input type="text" name="empE" id="empE" maxlength=5 size=5 readonly class="form-control" title="Código de la empresa" data-toggle="tooltip">	
										</div>					
										<div class="col-auto">
											<input type="text" name="nomE" id="nomE" maxlength=40 size=40 readonly class="form-control" title="Nombre de la empresa" data-toggle="tooltip">
										</div>
									</div>
								</form>
							</div>
			  		</div>
          
			<!-- Modal footer -->
			<div class="modal-footer bg-light">
		        <div align="center">
		            <p>¿Eliminar empresa? </p>  
		        </div>
		        <button type="button" class="btn btn-primary" 	id="SiEliminarEmpresa" data-bs-dismiss="modal">Sí</button>
		        <button type="button" class="btn btn-secondary" id="NoEliminarEmpresa" data-bs-dismiss="modal">No</button>
	        </div>

    	</div>
  	</div>  
</div>
<script>
	  $('#SiEliminarEmpresa').on('click', function(event) {
				let formData3 = new FormData();
				formData3.append('esBDempresas', 1);
				formData3.append("emp", window.idTabEmpresas);
				formData3.append("opcionListado", 3);
				async function eliminaEmpresa() {
					const response3 = await fetch('php/empresa.php', {
			      		method: 'POST',
			      		body: 	formData3,
			    	});
					const data3 = await response3.json();
					return data3;
				}
				eliminaEmpresa().then((data3) => {
						let eliEmpresa = eliminarReg('tabEmpresas', 'idTabEmpresas', 'emp', '');
						refrescar(1);				
				}).catch(error => {
						alert(error.message);
				});
	  });
</script>


<!-- Comienzo modal form empresa -->
<div class="modal fade" id="modalEmpresa" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	<div class="modal-dialog modal-xl">
  	<div class="modal-content">
        <!-- Modal Header -->
      	<div class="modal-header bg-dark bg-gradient sticky-top">
        	<div class="col-6">
            <a class="navbar-brand text-warning" id="exampleModalLabel">Empresa</a>
          </div>
			<div class="col-auto" style="text-align:right;">
				<form id="formEmpresa">
				<button type="submit" class="btn btn-success mr-3 text-white" id="aceptar" value="Aceptar" title="Guardar cambios" data-toggle="tooltip"><i class="bi bi-check-circle" style="font-size: 1rem; color: white;" ></i> </button>
				<button type="reset" class="btn btn-warning btn-sm" id="cancelar" value="Cancelar" title="Cancelar cambios" data-toggle="tooltip"><i class="bi bi-x-circle" style="font-size: 1rem;"></i> </button>	
			</div>
			<div class="col-1" style="text-align:right;">
        		<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" data-toggle="tooltip" title="Cerrar ventana">
          	</button>
          </div>
				</div>
  
      	<!-- Modal body -->
      	<div class="modal-body bg-primary bg-opacity-25" id="cuerpo1">
	        <div class="container-fluid">

				<div class="row align-items-end gx-3 gy-3 mb-3">
					<div class="col-auto">
						<label for="emp">Código</label>
						<input type="number" name="emp" id="emp" min=0 max=32767 size=5 required class="form-control" title="Código de empresa. Valor numérico entre 1 y 32.767. Si lo deja en cero, GestiónPYME lo rellenará automáticamente" data-toggle="tooltip">
					</div>				
					<div class="col-auto">
						<input type="text" name="nom" id="nom" placeholder="Nombre" maxlength=40 size=40 required class="form-control" title="Nombre de empresa. Máximo 40 caracteres" data-toggle="tooltip">
					</div>
					<div class="col-auto">
						<input type="text" name="nif" id="nif" placeholder="NIF" maxlength=35 size=35 class="form-control" title="NIF de la empresa. Máximo 35 caracteres" data-toggle="tooltip">
					</div>
					<div class="col-auto">
						<input type="text" name="noc" id="noc" placeholder="Nombre comercial" maxlength=40 size=40 class="form-control" title="Nombre comercial de la empresa. Máximo 40 caracteres" data-toggle="tooltip">
					</div>
				</div>


		        <div class="accordion accordion-flush mb-3" id="accordionFlushExample">
		          <div class="accordion-item">
		            <h2 class="accordion-header" id="flush-headingOne">
		              <button class="accordion-button collapsed bg-success bg-opacity-10" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
		                <i class="p-1 bi bi-shop-window" style="font-size: 1rem; color: currentColor;"></i>  Dirección fiscal
		              </button>
		            </h2>
		            <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
		               <div class="accordion-body bg-primary bg-opacity-25">


							<div class="row align-items-end gx-3 gy-3 mb-3">
								<div class="col-auto">
									<input type="text" name="dom" id="dom" size=50 placeholder="Dirección" maxlength="50" class="form-control" title="Dirección" data-toggle="tooltip">
								</div>

								<div class="col-auto">
									<input type="text" name="cpo" id="cpo" size=5 placeholder="C. P." maxlength="5" class="form-control" title="Código postal" data-toggle="tooltip">
								</div>

								<div class="col-auto">
									<input type="text" name="pob" id="pob" size=30 placeholder="Población" maxlength="30" class="form-control" title="Población" data-toggle="tooltip">
								</div>

								<div class="col-auto">
									<input type="text" name="pro" id="pro" size=30 placeholder="Provincia" maxlength="30" class="form-control" title="Provincia" data-toggle="tooltip">
								</div>

								<div class="col-auto">
									<input type="text" name="pai" id="pai" size=30 placeholder="País" maxlength="30" class="form-control" title="País" data-toggle="tooltip">
								</div>
							</div>


							<div class="row align-items-end gx-3 gy-3">
								<div class="col-auto">
									<div class="input-group">
										<input type="text" name="te1" id="te1" placeholder="Teléfono 1" maxlength="25" size=25 class="form-control" title="Teléfono 1" data-toggle="tooltip">
										<div class="input-group-append">
											<div class="btn-group">
		  										<button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton1D" data-bs-toggle="dropdown" aria-expanded="false">
		  										</button>
		  										<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1D">
												    <li><a class="dropdown-item" href="#" id="tel1LlamarD" onclick="hiperenlace(te1.value, 1)"><i class="bi bi-telephone" style="font-size: 1rem; color: currentColor;"></i> Llamar</a></li>
												    <li onclick="hiperenlace(te1.value, 3)"><a class="dropdown-item" href="#" id="tel1What
												    	D"><i class="bi bi-whatsapp" style="font-size: 1rem; color: currentColor;"></i> WhatsApp</a></li>
												    <li onclick="hiperenlace(te1.value, 2)"><a class="dropdown-item" href="#" id="tel1smsD"><i class="bi bi-chat-left-text" style="font-size: 1rem; color: currentColor;"></i> SMS</a></li>
													</ul>
		  									</div>
		  								</div>
		  							</div>
								</div>

								<div class="col-auto">
									<div class="input-group">
										<input type="text" name="te2" id="te2" placeholder="Teléfono 2" maxlength="25" size=25 class="form-control" title="Teléfono 2" data-toggle="tooltip">
										<div class="input-group-append">
											<div class="btn-group">
		  										<button class="btn btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton2D" data-bs-toggle="dropdown" aria-expanded="false">
		  										</button>
		  										<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2D">
												    <li><a class="dropdown-item" href="#" id="tel2LlamarD" onclick="hiperenlace(te2.value, 1)"><i class="bi bi-telephone" style="font-size: 1rem; color: currentColor;"></i> Llamar</a></li>
												    <li><a class="dropdown-item" href="#" id="tel2WhatD" onclick="hiperenlace(te2.value, 3)"><i class="bi bi-whatsapp" style="font-size: 1rem; color: currentColor;"></i> WhatsApp</a></li>
												    <li><a class="dropdown-item" href="#" id="tel2smsD" onclick="hiperenlace(te2.value, 2)"><i class="bi bi-chat-left-text" style="font-size: 1rem; color: currentColor;"></i> SMS</a></li>
												</ul>
		  									</div>
		  								</div>
		  							</div>
								</div>

								<div class="col-auto">
									<input type="text" name="fax" id="fax" size=25 placeholder="Fax" maxlength="25" class="form-control" title="Fax" data-toggle="tooltip">
								</div>

								<div class="col-auto">
									<div class="input-group">
										<input type="email" name="cor" id="cor" placeholder="Correo electrónico" maxlength="50" size=50 class="form-control" title="Correo electrónico" data-toggle="tooltip">
										<div class="input-group-append">
										<button type="button" class="btn btn-outline-secondary ml-auto" id="abrirD" title="Enviar un mensaje" data-toggle="tooltip" onclick="hiperenlace(cor.value, 5)"><i class="bi bi-at" style="font-size: 1rem; color: currentColor;"></i></button>
										</div>
									</div>
								</div>

								<div class="col-auto">
									<div class="input-group">
										<input type="url" name="www" id="www" placeholder="Dirección web" maxlength="50" size=50 class="form-control" title="Dirección web" data-toggle="tooltip">
										<div class="input-group-append">
										<button type="button" class="btn btn-outline-secondary ml-auto" id="abrirWeb" title="Visitar web" data-toggle="tooltip"><i class="bi bi-globe2" style="font-size: 1rem; color: currentColor;"></i></button>
										</div>
									</div>
								</div>
							</div>

									</div>
								</div>
							</div>

							<div class="accordion-item">
								<h2 class="accordion-header" id="flush-headingTwo">
									<button class="accordion-button collapsed bg-success bg-opacity-10" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
							    		<i class="p-1 bi bi-credit-card" style="font-size: 1rem; color: currentColor;"></i>  Ventas y compras
							  		</button>
								</h2>
								<div id="flush-collapseTwo" class="accordion-collapse collapse" aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
									<div class="accordion-body bg-primary bg-opacity-25">

						    		<div class="card border-1 border-primary rounded-3 mb-3">
						    			<div class="card-body bg-primary bg-opacity-25">
						    				<h6 class="card-subtitle mb-4 text-primary">Opciones por defecto al añadir un cliente</h6>

							    			<div class="row gx-3 gy-2 mb-3">
								    			<div class="col-auto">
									    			<label class="radio-inline control-label text-muted">Portes</label>
														<input type="radio" class="btn-check" name="por" id="por01" value=1>
														<label class="btn btn-outline-primary" for="por01" autocomplete="off">Debidos</label>
														<input type="radio" class="btn-check" name="por" id="por02" value=2>
														<label class="btn btn-outline-primary" for="por02" autocomplete="off">Pagados</label>
								    			</div>
								    			<div class="col-auto">
									    			<label class="radio-inline control-label text-muted">Forma de envío</label>
														<input type="radio" class="btn-check" name="foe" id="foe01" value=1>
														<label class="btn btn-outline-primary" for="foe01" autocomplete="off">Nuestros medios</label>
														<input type="radio" class="btn-check" name="foe" id="foe02" value=2>
														<label class="btn btn-outline-primary" for="foe02" autocomplete="off">Sus medios</label>
														<input type="radio" class="btn-check" name="foe" id="foe03" value=3>
														<label class="btn btn-outline-primary" for="foe03" autocomplete="off">Terceros</label>						
								    			</div>
								    		</div>

												<div class="row gx-3 gy-3 mb-3">
								    				<div class="col-auto">
								    					<label for="dtc" class="text-muted">Dto. comercial</label>
														<input type="text" name="dtc" id="dtc" required size=8 style="text-align:right;" class="form-control" title="Descuento comercial" data-toggle="tooltip">
													</div>
								    				<div class="col-auto">
								    					<label for="dtp" class="text-muted">Dto. pronto pago</label>
														<input type="text" name="dtp" id="dtp" required size=8 style="text-align:right;" class="form-control" title="Descuento por pronto pago" data-toggle="tooltip">
													</div>
									    			<div class="col-auto">
								    					<label for="inf" class="text-muted">Recargo financiero</label>
														<input type="text" name="inf" id="inf" required size=8 style="text-align:right;" class="form-control" title="Recargo financiero" data-toggle="tooltip">
													</div>
												</div>

												<div class="row gx-3 gy-3 align-items-end">
													<div class="col-auto">
								    				<label for="tit" class="text-muted">Tipo tarifa</label>
		                        <select name="tit" id="tit" class="form-select" title="Tipo tarifa" data-toggle="tooltip">
		                            <option value=1>A</option>
		                            <option value=2>B</option>
		                            <option value=3>C</option>
		                            <option value=4>D</option>
		                        </select>
								          </div>
													<div class="col-auto">
									    				<label for="per" class="text-muted">Facturación</label>
			                        <select name="per" id="per" class="form-select" title="Periodicidad de la facturación" data-toggle="tooltip">
			                            <option value=''></option>
			                            <option value='y'>Diaria</option>
			                            <option value='ww'>Semanal</option>
			                            <option value='m'>Mensual</option>
			                            <option value='q'>Trimestral</option>
			                        </select>
								          </div>
			                 	</div>

			                 </div>
			               </div>


						    		<div class="card border-1 border-primary rounded-3">
						    			<div class="card-body bg-primary bg-opacity-25">
						    				<h6 class="card-subtitle mb-2 text-primary">Pagos de la empresa</h6>

												<div class="row gx-3 gy-3">
							    				<div class="col-auto">
								    				<label for="dp1" class="text-muted">Día de pago 1</label>
								    				<input type="number" name="dp1" id="dp1" required value=0 min=0 max=31 size=2 style="text-align:right;" class="form-control" title="Día de pago 1" data-toggle="tooltip">
							    				</div>
							    				<div class="col-auto">
								    				<label for="dp2" class="text-muted">Día de pago 2</label>
								    				<input type="number" name="dp2" id="dp2" required value=0 min=0 max=31 size=2 style="text-align:right;" class="form-control" title="Día de pago 2" data-toggle="tooltip">
							    				</div>
							    				<div class="col-auto">
								    				<label for="dp3" class="text-muted">Día de pago 3</label>
								    				<input type="number" name="dp3" id="dp3" required value=0 min=0 max=31 size=2 style="text-align:right;" class="form-control" title="Día de pago 3" data-toggle="tooltip">
							    				</div>
							    				<div class="col-auto">
								    				<label for="mnp" class="text-muted">Mes no pago</label>
			                        <select name="mnp" id="mnp" class="form-select" title="Mes no pago" data-toggle="tooltip">
		                            <option value=0>Ninguno</option>
		                            <option value=1>Enero</option>
		                            <option value=2>Febrero</option>
		                            <option value=3>Marzo</option>
		                            <option value=4>Abril</option>
		                            <option value=5>Mayo</option>
		                            <option value=6>Junio</option>
		                            <option value=7>Julio</option>
		                            <option value=8>Agosto</option>
		                            <option value=9>Septiembre</option>
		                            <option value=10>Octubre</option>
		                            <option value=11>Noviembre</option>
		                            <option value=12>Diciembre</option>
			                        </select>			    					
								    				</div>
									    		</div>

									    	</div>
									    </div>

									</div>
								</div>
							</div>

						</div>
	        </div>
		    </div>
		    </form>
		</div>
	</div>
</div>


<script>
	
	modalEmpresa.addEventListener('hidden.bs.modal', function (e) { 
		document.getElementById('formEmpresa').reset();
	})

	modalEmpresa.addEventListener('show.bs.modal', function (e) {	

		if (window.opcionEmpresa === 1) {

			emp.defaultValue 		= 0;
			nom.defaultValue 		= '';
			nif.defaultValue 		= '';
			noc.defaultValue 		= '';
			dom.defaultValue 		= '';
			cpo.defaultValue 		= '';
			pob.defaultValue 		= '';
			pro.defaultValue 		= '';
			pai.defaultValue 		= '';
			te1.defaultValue 		= '';
			te2.defaultValue 		= '';
			fax.defaultValue 		= '';
			cor.defaultValue 		= '';
			www.defaultValue 		= '';
			dtc.defaultValue		= parseFloat(0).toFixed(2).replace('.', ',') + ' %';
			dtp.defaultValue		= parseFloat(0).toFixed(2).replace('.', ',') + ' %';
			inf.defaultValue		= parseFloat(0).toFixed(2).replace('.', ',') + ' %';
			seleccionarRadio('por', 1);
			seleccionarRadio('foe', 3);
			seleccionarCombo('tit', 1);
			seleccionarCombo('per', '');
			dp1.defaultValue		= 0;
			dp2.defaultValue		= 0;
			dp3.defaultValue		= 0;
			seleccionarCombo('mnp', 0);
			
			emp.readOnly 				= false;
			nom.readOnly 				= false;
			nif.readOnly 				= false;
			noc.readOnly 				= false;
			dom.readOnly 				= false;
			cpo.readOnly 				= false;
			pob.readOnly 				= false;
			pro.readOnly 				= false;
			pai.readOnly 				= false;
			te1.readOnly 				= false;
			te2.readOnly 				= false;
			fax.readOnly 				= false;
			cor.readOnly 				= false;
			www.readOnly 				= false;			
			dtc.readOnly 				= false;
			dtp.readOnly 				= false;
			inf.readOnly 				= false;
			desactivarRadio('por', false);
			desactivarRadio('foe', false);
			tit.disabled        = false;
			per.disabled        = false;
			dp1.readOnly 				= false;
			dp2.readOnly 				= false;
			dp3.readOnly 				= false;
			mnp.disabled        = false;

			aceptar.hidden 		= false;
      cancelar.hidden 	= false;

		}

		if (window.opcionEmpresa === 2 || window.opcionEmpresa === 4) {

			let queries2 = "SELECT `Empresa` AS `emp`,`NOMBRE` AS `nom`,`NIF` AS `nif`,`NombreComercial` AS `noc`,`DOMICILIO` AS `dom`,`COD_POSTAL` AS `cpo`,`POBLACION` AS `pob`,`PROVINCIA` AS `pro`,`PAIS` AS `pai`,`TELEFONO_1` AS `te1`,`TELEFONO_2` AS `te2`,`FAX` AS `fax`,`CE` AS `cor`, `www` AS `www`, round(`dto_comercial` * 100, 2) as `dtc`, round(`dto_pronto_pago` * 100, 2) as `dtp`, round(`recargo` * 100, 2) as `inf`, `PORTES` AS `por`, `FORMA_DE_ENVIO` AS `foe`, `TIPO_TARIFA` AS `tit`, `periodicidad` AS `per`, `dia_pago1` AS `dp1`, `dia_pago2` AS `dp2`, `dia_pago3` AS `dp3`, `mes_no_pago` AS `mnp` from `empresas` where `Empresa` = " + window.idTabEmpresas + ";"

			let formData2 = new FormData();
			formData2.append('queries', 			queries2);
			formData2.append('esBDempresas', 	1);
			async function datosDevueltos2() {
				const response2 = await fetch('php/multiselect.php', {
		      		method: 'POST',
		      		body: 	formData2
		    	});
				const data = await response2.json();
				return data;
			};
			datosDevueltos2().then((data) => {

				emp.defaultValue 		= data[0].emp;
				nom.defaultValue 		= data[0].nom;
				nif.defaultValue 		= data[0].nif || '';
				noc.defaultValue 		= data[0].noc || '';				
				dom.defaultValue 		= data[0].dom || '';
				cpo.defaultValue 		= data[0].cpo || '';
				pob.defaultValue 		= data[0].pob || '';
				pro.defaultValue 		= data[0].pro || '';
				pai.defaultValue 		= data[0].pai || '';
				te1.defaultValue 		= data[0].te1 || '';
				te2.defaultValue 		= data[0].te2 || '';
				fax.defaultValue 		= data[0].fax || '';
				cor.defaultValue 		= data[0].cor || '';
				www.defaultValue 		= data[0].www || '';
				dtc.defaultValue 		= parseFloat(data[0].dtc).toFixed(2).replace('.', ',') + ' %';
				dtp.defaultValue 		= parseFloat(data[0].dtp).toFixed(2).replace('.', ',') + ' %';
				inf.defaultValue 		= parseFloat(data[0].inf).toFixed(2).replace('.', ',') + ' %';
				seleccionarRadio('por', data[0].por);
				seleccionarRadio('foe', data[0].foe);
				seleccionarCombo('tit', data[0].tit);
				seleccionarCombo('per', data[0].per);
				dp1.defaultValue 		= data[0].dp1;
				dp2.defaultValue 		= data[0].dp2;
				dp3.defaultValue 		= data[0].dp3;
				seleccionarCombo('mnp', data[0].mnp);

				if (window.opcionEmpresa === 2) {
						emp.readOnly 		= true;
						nom.readOnly 		= false;
						nif.readOnly 		= false;
						noc.readOnly 		= false;
						dom.readOnly 		= false;
						cpo.readOnly 		= false;
						pob.readOnly 		= false;
						pro.readOnly 		= false;
						pai.readOnly 		= false;
						te1.readOnly 		= false;
						te2.readOnly 		= false;
						fax.readOnly 		= false;
						cor.readOnly 		= false;
						www.readOnly 		= false;
						dtc.readOnly 		= false;
						dtp.readOnly 		= false;
						inf.readOnly 		= false;									
						desactivarRadio('por', false);
						desactivarRadio('foe', false);
						tit.disabled    = false;
						per.disabled    = false;	
						dp1.readOnly 		= false;
						dp2.readOnly 		= false;
						dp3.readOnly 		= false;
						mnp.disabled    = false;											
						aceptar.hidden 	= false;
      					cancelar.hidden = false;
				}		

				if (window.opcionEmpresa === 4) {
						emp.readOnly 		= true;
						nom.readOnly 		= true;
						nif.readOnly 		= true;
						noc.readOnly 		= true;
						dom.readOnly 		= true;
						cpo.readOnly 		= true;
						pob.readOnly 		= true;
						pro.readOnly 		= true;
						pai.readOnly 		= true;
						te1.readOnly 		= true;
						te2.readOnly 		= true;
						fax.readOnly 		= true;
						cor.readOnly 		= true;
						www.readOnly 		= true;
						dtc.readOnly 		= true;
						dtp.readOnly 		= true;
						inf.readOnly 		= true;						
						desactivarRadio('por', true);
						desactivarRadio('foe', true);
						tit.disabled    = true;
						per.disabled    = true;
						dp1.readOnly 		= true;
						dp2.readOnly 		= true;
						dp3.readOnly 		= true;
						mnp.disabled    = true;									
						aceptar.hidden 	= true;
      					cancelar.hidden = true;				
				}			

			})
		}

		document.getElementById('formEmpresa').reset();

	})



	formEmpresa.onsubmit = async (e) => {

		e.preventDefault();

		let sMask1 			= dtc.value;
		let numSinMascara 	= quitarMascara(sMask1, ',');
		dtc.value			= numSinMascara;     

		sMask1 				= dtp.value;
		numSinMascara 		= quitarMascara(sMask1, ',');
		dtp.value			= numSinMascara; 

		sMask1 				= inf.value;
		numSinMascara 		= quitarMascara(sMask1, ',');
		inf.value			= numSinMascara; 	  

		var filaEmpresa = {
			emp: emp.value,
			nom: nom.value,
			nif: nif.value,
			noc: noc.value,
			dom: dom.value,
			cpo: cpo.value,
			pob: pob.value,
			pro: pro.value,
			pai: pai.value,
			te1: te1.value,
			te2: te2.value,
			fax: fax.value,
			cor: cor.value,
			www: www.value,
			dtc: dtc.value,
			dtp: dtp.value,
			inf: inf.value,
			por: dValorRadio('por'),
			foe: dValorRadio('foe'),
			tit: tit.value,
			per: per.value,
			dp1: dp1.value,
			dp2: dp2.value,
			dp3: dp3.value,
			mnp: mnp.value
    	};



    	let finalizadoNuevaEmp = false;
	    async function datosDevueltos1() {
	      	let formData1 = new FormData(formEmpresa);
	      	formData1.append('esBDempresas', 1);
	      	formData1.append('opcionListado', window.opcionEmpresa);
	      	formData1.append('por', dValorRadio('por'));
	      	formData1.append('foe', dValorRadio('foe'));
	      	const response1 = await fetch('php/empresa.php', {
	        	method: 'POST',
	        	body:   formData1
	      	});
	      	const data1 = await response1.json();
	      	return data1;
	    }

	    datosDevueltos1().then((data1) => {
	    	if (data1.toString().substring(0, 4) == 'codN') {
	    		cerrarModal('modalEmpresa');
		        filaEmpresa.emp = data1.toString().substring(4);
		        window.idTabEmpresas = filaEmpresa.emp;
		        $('#tabEmpresas').bootstrapTable('append', filaEmpresa);
		        refrescar (1);
		        finalizadoNuevaEmp = true;
			} else if (data1 == '0') {
				cerrarModal('modalEmpresa');
				$('#tabEmpresas').bootstrapTable('updateByUniqueId', {
					id:      window.idTabEmpresas,
					row:     filaEmpresa,
					replace: false
				});
				datosFichaEmpresa (window.idTabEmpresas);
			} else if (data1 == '1') {
				emp.focus();
				msjEmpresa.innerHTML  = 'Código ya existente';
				let myModalNuevo1     = new bootstrap.Modal(dialogoEmpresa);
				myModalNuevo1.show();
			} else if (data1 == '2') {
				nom.focus();
				msjEmpresa.innerHTML  = 'Nombre ya existente';
				let myModalNuevo2     = new bootstrap.Modal(dialogoEmpresa);
				myModalNuevo2.show();
			} else {
				msjEmpresa.innerHTML  = data1;
				let myModalNuevo3     = new bootstrap.Modal(dialogoEmpresa);
				myModalNuevo3.show();
			}
		}).catch(error => {
			alert(error.message);
		}).finally( ()  => {
			if (finalizadoNuevaEmp) { abrirEmpresaSeleccionada(); }
		});
	}

	dtc.addEventListener('focus', (event) => { porcentajeFocus(dtc.value); 	});
	dtc.addEventListener('blur', 	(event) => { porcentajeBlur ('dtc'); 		});

	dtp.addEventListener('focus', (event) => { porcentajeFocus(dtp.value); 	});
	dtp.addEventListener('blur', 	(event) => { porcentajeBlur ('dtp'); 		});

	inf.addEventListener('focus', (event) => { porcentajeFocus(inf.value); 	});
	inf.addEventListener('blur', 	(event) => { porcentajeBlur ('inf'); 		});

</script>


<!-- Comienzo modal mensajes -->
<div class="modal" id="dialogoEmpresa" tabindex="-1">
  <div class="modal-dialog">
	  <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header bg-light">
        <h5 class="modal-title">GestiónPYME</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" data-toggle="tooltip" title="Cerrar ventana"></button>
      </div>       
      <!-- Modal body -->
      <div class="modal-body">
				<div align="center">
					<p id="msjEmpresa">No se puede eliminar la empresa</p>  
				</div>
      </div>
    </div>
  </div>  
</div>

</body>

</html>